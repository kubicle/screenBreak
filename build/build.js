(function(){function t(e,n,i){function o(s,a){if(!n[s]){if(!e[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(r)return r(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var h=n[s]={exports:{}};e[s][0].call(h.exports,function(t){var n=e[s][1][t];return o(n||t)},h,h.exports,t,e,n,i)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<i.length;s++)o(i[s]);return o}return t})()({1:[function(t,e,n){"use strict";function i(t){t=t||{};this.name=t.name||"";this.timeWorked=t.timeWorked||0}e.exports=i;i.prototype.serialize=function(){return{name:this.name,timeWorked:this.timeWorked}};i.prototype.getName=function(){return this.name};i.prototype.getTimeWorked=function(){return this.timeWorked};i.prototype.updateTime=function(t){this.timeWorked=t};i.prototype.rename=function(t){this.name=t}},{}],2:[function(t,e,n){"use strict";var i=t("./Task");var o=6e4,r=36e5;var s=60*o;var a=5*o;var l=6*r;function u(t){this.level=0;this.isResting=true;t=t||{};this.lastUserAction=Date.now();this.time0=t.lastWorkTime||Date.now();this.taskWork=t.taskWork||0;this.fatigue=t.fatigue||0;this.tasks=t.tasks||{};this.todaysWork=t.todaysWork||0;this.todaysLongestWork=t.todaysLongestWork||0;this.todaysTooLongCount=t.todaysTooLongCount||0;if(t.curTaskName!==undefined){this._loadCurTask(t.curTaskName)}else{this._createTask()}}e.exports=u;u.prototype.gotBreak=function(t){var e=t*o;this._removeFatigue(e);this.taskWork=Math.max(this.taskWork-e,0);this.todaysWork=Math.max(this.todaysWork-e,0)};u.prototype.serialize=function(){this._saveCurTask();return{lastWorkTime:this.time0,taskWork:this.taskWork,todaysWork:this.todaysWork,fatigue:this.fatigue,tasks:this.tasks,curTaskName:this.curTask.name}};u.prototype.start=function(){if(!this.isResting)return;this._startTimePeriod();this.isResting=false};u.prototype.stop=function(){if(this.isResting)return;this._startTimePeriod();this.isResting=true};u.prototype.backFromSleep=function(t){if(this.isResting){this._startTimePeriod()}else{this.time0+=t;this._startTimePeriod();this._removeFatigue(t)}};u.prototype._startTimePeriod=function(){this._countTime();this.lastUserAction=Date.now()};u.prototype._countTime=function(){var t=Date.now();var e=t-this.time0;this.time0=t;if(t-this.lastUserAction>=l){this.todaysWork=0;this.todaysLongestWork=0;this.todaysTooLongCount=0;this.fatigue=0;this.lastUserAction=Date.now();e=0}if(this.isResting){this._removeFatigue(e)}else{this._addFatigue(e);this.taskWork+=e;this.todaysWork+=e;if(e>this.todaysLongestWork)this.todaysLongestWork=e;if(e>r)this.todaysTooLongCount++}this.level=this.fatigue/a*100};u.prototype._removeFatigue=function(t){this.fatigue=Math.max(this.fatigue-t,0)};u.prototype._addFatigue=function(t){this.fatigue+=t/s*a};u.prototype._loadCurTask=function(t){this.curTask=new i(this.tasks[t]);this.taskWork=this.curTask.timeWorked};u.prototype._saveCurTask=function(){this.curTask.updateTime(this.taskWork);this.tasks[this.curTask.name]=this.curTask.serialize()};u.prototype._createTask=function(){this.curTask=new i;this.taskWork=0};u.prototype.newTask=function(t){this._saveCurTask();this._createTask();if(t)this.curTask.rename(t);this._saveCurTask()};u.prototype.deleteTask=function(){delete this.tasks[this.curTask.name];for(var t in this.tasks){return this._loadCurTask(t)}this._createTask()};u.prototype.switchTask=function(t){this._saveCurTask();this._loadCurTask(t)};u.prototype.renameTask=function(t){delete this.tasks[this.curTask.name];this.curTask.rename(t)};u.prototype.editTaskTime=function(t){this.curTask.updateTime(t);this.taskWork=t};u.prototype.getTask=function(){return this.curTask};u.prototype.getStatus=function(t){this._countTime();t.isResting=this.isResting;t.taskName=this.curTask.name;t.taskWork=this.taskWork;t.todaysWork=this.todaysWork;t.fatigue=this.fatigue;t.level=this.level};u.prototype.getLevel=function(){return this.level}},{"./Task":1}],3:[function(t,e,n){"use strict";var i=t("../package.json");var o=t("./ui/Ui");var r=t("./Workometer");var s=t("./nwUtil");var a=t("./localPref");var l=1e3,u=6e4;var h=1*u;var c=1*l;var p=15*u;var d=1*u;var f=75*u;var g=100;var v=10*u;function m(){s.initialize();this.appName=i.name;this.appVersion=i.version;this.ui=this.workometer=null;this.isWorking=false;this.lastRefresh=Date.now();this.currentFreq=0}m.prototype.initialize=function(){this.workometer=new r(a.getValue("workometerState"));this.ui=new o(this,this.userEventHandler.bind(this));this.ui.createUi();this.refreshMethod=this.refresh.bind(this);this.refreshInterval=null;s.listenBeforeunload(this.terminate.bind(this));this._noteUserIsHere();this.toggle()};m.prototype.terminate=function(){this.workometer.stop();this._save();a.terminate();s.terminate()};m.prototype._save=function(){a.setValue("workometerState",this.workometer.serialize())};m.prototype.refresh=function(){var t=Date.now();var e=t-this.lastRefresh;this.lastRefresh=t;var n=e-this.currentFreq;if(n>5*l){this.workometer.backFromSleep(n);if(this.isWorking)this.toggle()}this.ui.refresh();this._checkAlert()};m.prototype._checkAlert=function(){var t=Date.now();var e=t-this.lastAlertTime;if(this.isWorking){this._save();if(e>=p){this.lastAlertTime=t;this.ui.showAlert(5)}var n=t-this.lastUserActionTime;if(this.workometer.getLevel()>=g&&n>v){this.ui.showAlert()}if(n>f){this.toggle()}}else{if(e>=d){this.lastAlertTime=t;this.ui.showAlert(20)}}};m.prototype.toggle=function(){if(this.isWorking){this.workometer.stop()}else{this.workometer.start()}this.isWorking=!this.isWorking;this.ui.setWorking(this.isWorking);this.refresh();window.clearInterval(this.refreshInterval);this.currentFreq=this.isWorking?h:c;this.refreshInterval=window.setInterval(this.refreshMethod,this.currentFreq)};m.prototype._noteUserIsHere=function(){this.ui.stopAlert();this.lastUserActionTime=this.lastAlertTime=Date.now()};m.prototype.gotBreak=function(){this.workometer.gotBreak(5);this.refresh()};m.prototype.backToWork=function(){if(!this.isWorking)this.toggle()};m.prototype.goOnPause=function(){if(this.isWorking)this.toggle()};m.prototype.userEventHandler=function(t){this._noteUserIsHere();switch(t){case"pause":return this.goOnPause();case"backToWork":return this.backToWork();case"gotBreak":return this.gotBreak();case"exit":return this.terminate()}};var k=new m;k.initialize()},{"../package.json":23,"./Workometer":2,"./localPref":4,"./nwUtil":6,"./ui/Ui":13}],4:[function(t,e,n){"use strict";var i=t("./log");var o="screenBreak.1";function r(){this.saveTimeout=null;this.map={};this._saveHandler=this._saveNow.bind(this);try{var t=window.localStorage.getItem(o);if(t)this.map=JSON.parse(t)}catch(e){i.logError("Cannot load local preferences: "+e)}}r.prototype.terminate=function(){if(this.saveTimeout)this._saveNow()};r.prototype._saveLater=function(){if(this.saveTimeout)return;this.saveTimeout=window.setTimeout(this._saveHandler,6e4)};r.prototype._saveNow=function(){window.clearTimeout(this.saveTimeout);this.saveTimeout=null;try{window.localStorage.setItem(o,JSON.stringify(this.map))}catch(t){i.logError("Cannot save local preferences: "+t)}};r.prototype.getValue=function(t,e){var n=this.map[t];return n!==undefined?n:e};r.prototype.setValue=function(t,e){this.map[t]=e;this._saveLater()};e.exports=new r},{"./log":5}],5:[function(t,e,n){"use strict";var i=console;var o=0,r=1,s=2,a=3,l=4;function u(){this.level=NaN;this.logfunc=null;this.DEBUG=0;this.INFO=1;this.WARN=2;this.ERROR=3;this.FATAL=4;this.debugBreed=false;this.debugGroup=false}u.prototype.setLevel=function(t){if(t===this.level)return;this.level=t;this.debug=t<=o?this.logDebug:null;this.info=t<=r?this.logInfo:null;this.warn=t<=s?this.logWarn:null;this.error=t<=a?this.logError:null;this.fatal=t<=l?this.logFatal:null};u.prototype.setLogFunc=function(t){this.logfunc=t};u.prototype._newLogFn=function(t,e){var n=this;return function(o){if(n.level>t)return;if(n.logfunc&&!n.logfunc(t,o))return;e.call(i,o)}};var h=e.exports=new u;u.prototype.logDebug=h._newLogFn(o,i.debug);u.prototype.logInfo=h._newLogFn(r,i.info);u.prototype.logWarn=h._newLogFn(s,i.warn);u.prototype.logError=h._newLogFn(a,i.error);u.prototype.logFatal=h._newLogFn(l,i.error);h.setLevel(r)},{}],6:[function(t,e,n){"use strict";var i=t("./ui/Arranger");var o=false;var r=false;var s=[];var a=null;var l,u,h,c;var p,d,f,g,v;var m,k,w,y;var b=0;function x(){}x.prototype.getWidth=function(){return w};x.prototype.getHeight=function(){return y};x.prototype.addElement=function(t){if(r){var e=2*a.MARGIN;if(t.width+e>w||t.height+e>y){var n=Math.max(w,t.width+e);var i=Math.max(y,t.height+e);D(n,i);var o=Math.min(m,h+l-n);var s=Math.min(k,c+u-i);if(o!==m||s!==k)T(o,s)}}};x.prototype.reduce=function(t,e){if(r){var n=a.MARGIN;t+=n;e+=n;var i=m,o=k;var s=w,p=y;if(t<w){if(m<d)i=Math.min(d,h+l-t);s=Math.max(g,t)}if(e<y){if(k<f)o=Math.min(f,c+u-e);p=Math.max(v,e)}if(i!==m||o!==k)T(i,o);if(s!==w||p!==y)D(s,p)}};function T(t,e){b=Date.now();p.x=t;p.y=e;m=t;k=e}function D(t,e){p.width=t;p.height=e;w=t;y=e}n.getArranger=function(){if(a)return a;a=new i(new x);return a};function _(){var t=nw.Screen.screens,e;if(!t)return console.warn("nw.Screen.screens is undefined");for(var n=0;n<t.length;n++){e=t[n].work_area;if(m>=e.x&&m<e.x+e.width&&k>=e.y&&k<e.y+e.height){break}}h=e.x;c=e.y;l=e.width;u=e.height}function B(){m=d=p.x;k=f=p.y;w=g=p.width;y=v=p.height}function W(){h=c=0;l=w=document.documentElement.clientWidth;u=y=document.documentElement.clientHeight}function M(){l=w=document.documentElement.clientWidth;u=y=document.documentElement.clientHeight}n.listenBeforeunload=function(t){s.push(t)};function C(){for(var t=0;t<s.length;t++){s[t]()}return true}function L(){nw.Screen.Init();p=nw.Window.get();B();p.on("close",function(){C()});p.on("move",function(t,e){m=t;k=e;if(Date.now()-b>200){d=t;f=e;_()}});_()}function A(){nw.Window.get().close(true)}function E(){window.addEventListener("beforeunload",C);window.addEventListener("resize",M);W()}n.initialize=function(){o=true;r=typeof process!=="undefined"&&!!process.versions["node-webkit"];if(r){L()}else{E()}};n.terminate=function(){if(r){A()}};n.isNw=function(){return r}},{"./ui/Arranger":7}],7:[function(t,e,n){"use strict";var i=t("./Dome");var o=10;function r(t){this.viewportHandler=t;this.MARGIN=o;this.xMin=[];this.yMin=[];this.xMax=[];this.yMax=[]}e.exports=r;r.prototype._tryToFit=function(t,e){var n=this.viewportHandler.getWidth();var i=this.viewportHandler.getHeight();var r=Math.max(Math.min(t.left,n-t.width-o),o);var s=Math.max(Math.min(t.top,i-t.height-o),o);e[0]+=r-t.left;e[1]+=s-t.top;t.left=r;t.top=s};r.prototype.addElement=function(t){t.style.transform=null;var e=[0,0];var n=i.getRect(t);this._tryToFit(n,e);this.viewportHandler.addElement(n);this._tryToFit(n,e);t.style.transform="translate("+e[0]+"px, "+e[1]+"px)";this.xMin.push(n.left);this.yMin.push(n.top);this.xMax.push(n.left+n.width);this.yMax.push(n.top+n.height);t._rect=n};function s(t,e){var n=t.indexOf(e);if(n!==-1)t.splice(n,1)}r.prototype.removeElement=function(t){var e=t._rect;s(this.xMin,e.left);s(this.yMin,e.top);s(this.xMax,e.left+e.width);s(this.yMax,e.top+e.height);var n=Math.max.apply(null,this.xMax);var i=Math.max.apply(null,this.yMax);this.viewportHandler.reduce(n,i)}},{"./Dome":9}],8:[function(t,e,n){"use strict";t("./contextMenu.less");var i=t("./Dome");var o=t("./getText");var r=t("./PopupDlg");function s(){this.options=[];this.parent=document.body;this.menu=i.newDiv(null,"contextMenu")}e.exports=s;function a(){this.contextMenu._close();if(this.action)this.action.call(this)}s.prototype.addOption=function(t,e){var n=i.newDiv(this.menu,"menuOption").setText(t);n.action=e;n.contextMenu=this;i.tapBehavior(n,a);this.options.push(n);return n};s.prototype.attachMenu=function(t){this.addOption(o("cancelAction"),null);var e=i.getRect(t);this.menu.setStyle("left",e.left+e.width/2+"px");this.menu.setStyle("top",e.top+e.height/2+"px");r.attachWithOverlay(this.menu,this.parent)};s.prototype.detachMenu=function(){r.detachWithOverlay(this.menu)};s.prototype._close=function(){this.detachMenu()}},{"./Dome":9,"./PopupDlg":10,"./contextMenu.less":14,"./getText":16}],9:[function(t,e,n){"use strict";var i=null;var o=null;var r=null;var s=1;a.init=function(t,e){o=t;i=e};function a(t,e,n,i){this.type=e;var s=this.elt=document.createElement(e);this.isFloating=false;if(i&&i[0]==="#"){r.add(i.substr(1),this);if(n[0]==="#")n=n.substr(1)}if(n)s.className=n;if(o)o.paint(s,n);if(t){(t instanceof a?t.elt:t).appendChild(s)}}e.exports=a;a.prototype.appendTo=function(t,e){(t instanceof a?t.elt:t).appendChild(this.elt);this.isFloating=e;if(i&&e)i.addElement(this.elt)};a.removeChild=function(t,e){if(i&&e.isFloating)i.removeElement(e.elt);if(t instanceof a)t=t.elt;t.removeChild(e.elt)};a.prototype.removeChild=function(t){a.removeChild(this,t)};a.prototype.setText=function(t){this.elt.textContent=t;return this};a.prototype.setHtml=function(t){this.elt.innerHTML=t;return this};a.prototype.setAttribute=function(t,e){this.elt.setAttribute(t,e);return this};a.prototype.setStyle=function(t,e){this.elt.style[t]=e;return this};a.prototype.setVisible=function(t){if(t===this.isVisible())return this;this.elt.style.display=t?"":"none";this._isVisible=!!t;if(i&&this.isFloating){if(t)i.addElement(this.elt);else i.removeElement(this.elt)}return this};a.prototype.isVisible=function(){return this._isVisible||this._isVisible===undefined};a.prototype.setEnabled=function(t){this.elt.disabled=!t;this.toggleClass("disabled",!t);return this};a.prototype.text=function(){return this.elt.textContent};a.prototype.html=function(){return this.elt.innerHTML};a.prototype.value=function(){return this.elt.value};a.prototype.isChecked=function(){return this.elt.checked};a.prototype.getDomElt=function(){return this.elt};a.prototype.clear=function(){this.elt.innerHTML=""};a.prototype.on=function(t,e){var n=this;this.elt.addEventListener(t,function(t){e.call(n,t)})};a.prototype.toggleClass=function(t,e){var n=this.elt;var i=n.className,r=" "+i+" ";var s=" "+t+" ";var a=r.indexOf(s);if(e){if(a>=0)return;if(o)o.toggle(n,t,e);n.className=i+" "+t}else{if(a<0)return;n.className=r.replace(s," ").trim();if(o)o.toggle(n,t,e)}};a.prototype.scrollToBottom=function(){this.elt.scrollTop=this.elt.scrollHeight};a.newDiv=function(t,e,n){return new a(t,"div",e,n||e)};a.prototype.newDiv=function(t,e){return new a(this,"div",t,e||t)};a.newButton=function(t,e,n,i){var o=new a(t,"button",e+"Button",e);if(n)o.elt.innerText=n;o.on("click",i);return o};a.newBtn=function(t,e,n,i){var o=a.newDiv(t,e).setText(n);o.on("click",i);return o};a.newGfxBtn=function(t,e,n){var i=a.newBtn(t,e,null,n);i.newDiv(e+"Icon btnIcon");return i};a.tapBehavior=function(t,e){t.on("click",function(t){t.stopPropagation();e.call(this)})};a.newLink=function(t,e,n,i){var o=new a(t,"a",e+"Link",e);o.setAttribute("href",i);o.setText(n);return o};a.newLabel=function(t,e,n){return new a(t,"div",e,e).setText(n)};a.newBreak=function(t){return new a(t,"br")};a.newInput=function(t,e,n,i){var o=e+"Label";a.newLabel(t,o+" inputLbl",n,o);var r=new a(t,"input",e+"Input inputBox",e);if(i!==undefined)r.elt.value=i;return r};a.newCheckbox=function(t,e,n,i,o){var r=new a(t,"div",e+"Div chkBoxDiv");var l=new a(r,"input",e+"ChkBox chkBox",e);var u=l.elt;u.type="checkbox";u.name=e;if(i!==undefined)u.value=i;u.id=e+"ChkBox"+(i!==undefined?i:s++);if(o)u.checked=true;new a(r,"label",e+"ChkLabel chkLbl",e).setText(n).setAttribute("for",u.id);return l};a.newRadio=function(t,e,n,i,o){if(!i)i=n;var r=[];for(var s=0;s<n.length;s++){var l=r[s]=new a(t,"input",e+"RadioBtn radioBtn",e);var u=l.elt;u.type="radio";u.name=e;u.value=i[s];u.id=e+"Radio"+i[s];if(i[s]===o)u.checked=true;new a(t,"label",e+"RadioLabel radioLbl",e).setText(n[s]).setAttribute("for",u.id)}return r};a.getRadioValue=function(t){for(var e=0;e<t.length;e++){if(t[e].elt.checked)return t[e].elt.value}};a.newDropdown=function(t,e,n,i,o){if(!i)i=n;var r=new a(t,"select",e+"DropDwn dropDwn",e);r.values=i;var s=0;for(var l=0;l<n.length;l++){var u=new a(r,"option").elt;u.value=i[l];u.textContent=n[l];if(i[l]===o)s=l}r.elt.selectedIndex=s;return r};a.prototype.select=function(t){var e=this.values.indexOf(t);if(e!==-1)this.elt.selectedIndex=e};function l(t,e,n,i){this.left=t;this.top=e;this.width=n;this.height=i}a.getRect=function(t){var e=(t.elt||t).getBoundingClientRect();return new l(e.left,e.top,e.width,e.height)};function u(){this.ctrl={}}a.newGroup=function(){r=new u;return r};u.prototype.add=function(t,e){this.ctrl[t]=e};u.prototype.get=function(t){return this.ctrl[t]};u.prototype.setEnabled=function(t,e,n){if(t==="ALL")t=Object.keys(this.ctrl);for(var i=0;i<t.length;i++){if(n&&n.indexOf(t[i])!==-1)continue;var o=this.ctrl[t[i]];if(!o){console.error("Invalid control name:",t[i]);continue}o.setEnabled(e)}};u.prototype.setVisible=function(t,e,n){if(t==="ALL")t=Object.keys(this.ctrl);for(var i=0;i<t.length;i++){if(n&&n.indexOf(t[i])!==-1)continue;var o=this.ctrl[t[i]];if(!o){console.error("Invalid control name:",t[i]);continue}o.setVisible(e)}};a.setPageTitle=function(t){document.head.getElementsByTagName("title")[0].textContent=t};a.getSelectedText=function(){var t=window.getSelection();if(!t.rangeCount)return null;var e=t.getRangeAt(0);var n=e.startContainer.data;if(!n)return null;return n.substring(e.startOffset,e.endOffset)};a.downloadFile=function(t,e){var n=new Blob([t]);var i=document.createElement("a");i.href=URL.createObjectURL(n);i.download=e;i.click()};a.prototype.hasFile=function(){var t=this.elt.files;return t&&t.length>0};a.prototype.uploadFile=function(t){var e=this.elt.files;if(!e)return console.error("Invalid field type for uploadFile: "+this.type);if(!e.length)return false;var n=new FileReader;n.readAsText(e[0]);n.onloadend=function(){return t(n.result)};return true}},{}],10:[function(t,e,n){"use strict";t("./popupDlg.less");var i=t("./Dome");var o=t("./getText");function r(){var t=this.dlg;if(t.options)t.options.choice=this.id;a.detachWithOverlay(t.dialog);if(t.validateFn)t.validateFn(t.options)}function s(t,e,n,o){var s=i.newButton(t,"popupDlg",n,r);s.dlg=e;s.id=o}function a(t,e,n,r,l){this.parent=t||document.body;this.options=r;this.validateFn=l;var u=this.dialog=i.newDiv(null,"popupDlg dialog");u.newDiv("dialogTitle").setText(n||o("problem"));var h=u.newDiv("content");i.newLabel(h,"message",e);var c=r&&r.buttons||[o("OK")];var p=u.newDiv("btnDiv");for(var d=0;d<c.length;d++){s(p,this,c[d],d)}a.attachWithOverlay(this.dialog,this.parent)}e.exports=a;function l(t){var e=i.newDiv(null,"popupOverlay");if(t){t=t.elt||t;e.setStyle("left",t.offsetLeft+"px");e.setStyle("top",t.offsetTop+"px");e.setStyle("height",t.scrollHeight+"px")}return e}a.attachWithOverlay=function(t,e){var n=t.overlay=l();n.parent=e;n.appendTo(e);t.appendTo(n,true);n.setStyle("opacity",1)};a.detachWithOverlay=function(t){t.overlay.setStyle("opacity",0);window.setTimeout(function(){t.setVisible(false);i.removeChild(t.overlay.parent,t.overlay)},300)}},{"./Dome":9,"./getText":16,"./popupDlg.less":18}],11:[function(t,e,n){"use strict";t("./taskDlg.less");var i=t("./Dome");var o=t("./getText");var r=t("./PopupDlg");var s=t("./util");function a(t,e,n){var a=t==="new";this.workometer=e.app.workometer;this.task=this.workometer.getTask();this.cb=n;this.oldName=a?"":this.task.getName();this.oldTime=s.ms2str(this.task.getTimeWorked());var l=this.dialog=i.newDiv(null,"taskDlg dialog");l.newDiv("dialogTitle").setText(a?o("newTaskTitle"):o("editTaskTitle"));var u=l.newDiv("content");this.name=i.newInput(u,"name",o("taskName")+":",this.oldName);if(!a)this.time=i.newInput(u,"time",o("taskTime")+":",this.oldTime);var h=l.newDiv("btnDiv");if(a)this._newButton(h,"newTask",o("newTask"));if(!a&&this.oldName)this._newButton(h,"delTask",o("delTask"));if(!a)this._newButton(h,"edit",o("OK"));this._newButton(h,"cancel",o("cancelAction"));r.attachWithOverlay(this.dialog,document.body);this.name.elt.focus()}e.exports=a;function l(){this.dlg._validate(this.action)}a.prototype._newButton=function(t,e,n){var o=i.newButton(t,e,n,l);o.action=e;o.dlg=this};a.prototype._validate=function(t){var e=this.name.value();switch(t){case"edit":if(e&&e!==this.oldName){this.workometer.renameTask(e)}var n=this.time.value();if(n!==this.oldTime){var i=s.str2ms(n);if(!i&&i!==0){return new r(this.dialog,o("invalidValue")+": "+n)}this.workometer.editTaskTime(i)}break;case"newTask":this.workometer.newTask(e);break;case"delTask":var a=o("delTask")+": "+this.oldName+"?";var l={buttons:[o("cancelAction"),o("OK")]};var u=this;return new r(this.dialog,a,o("confirmTitle"),l,function(t){if(!t.choice)return;u.workometer.deleteTask();u._close()});case"cancel":break}this._close()};a.prototype._close=function(){r.detachWithOverlay(this.dialog);this.cb()}},{"./Dome":9,"./PopupDlg":10,"./getText":16,"./taskDlg.less":19,"./util":20}],12:[function(t,e,n){"use strict";var i=10;var o=50;var r=300;var s=500;var a=0;function l(){this.startX=this.startY=0;this.holding=this.dragging=false;this.target=null;this.touchCount=this.startTime=this.lastMoveTime=0}var u=e.exports=new l;function h(t){var e=t.currentTarget;u.touchCount+=t.changedTouches.length;if(u.touchCount>1){return u._cancelDrag(e)}u._onTouchStart(t.changedTouches[0],e)}function c(t){u.touchCount-=t.changedTouches.length;if(u.touchCount>0)return console.warn("Extra touchend count?",t);if(u._onTouchEnd(t.changedTouches[0],u.target)){t.preventDefault()}}function p(t){if(t.changedTouches.length>1)return u._cancelDrag(u.target);if(u._onTouchMove(t.changedTouches[0],u.target)){t.preventDefault()}}function d(t){u.touchCount-=t.changedTouches.length;u._cancelDrag(u.target)}function f(t){if(t.button!==a)return;u._onTouchStart(t,t.currentTarget)}function g(t){if(t.button!==a)return;if(u._onTouchEnd(t,u.target)){t.preventDefault()}}function v(t){if(u._onTouchMove(t,u.target)){t.preventDefault()}}l.prototype._listen=function(t,e){if(e){if(this.target!==null)console.error("Forgot to stop listening on",this.target);this.holding=true;this.target=t;t.addEventListener("touchmove",p,{passive:true});t.addEventListener("touchend",c);t.addEventListener("touchcancel",d);document.addEventListener("mousemove",v);document.addEventListener("mouseup",g)}else{if(this.target===null)return console.warn("Not listening anyway");this.holding=false;this.target=null;t.removeEventListener("touchmove",p);t.removeEventListener("touchend",c);t.removeEventListener("touchcancel",d);document.removeEventListener("mousemove",v);document.removeEventListener("mouseup",g)}};l.prototype._onTouchStart=function(t,e){this._listen(e,true);this.holding=true;this.startX=t.clientX;this.startY=t.clientY;this.startTime=Date.now();var n=this;if(this.holdTimeout)window.clearTimeout(this.holdTimeout);this.holdTimeout=window.setTimeout(function(){n.holdTimeout=null;if(n.holding&&!n.dragging)n._startDrag(t,e)},r)};l.prototype._startDrag=function(t,e){this.dragging=true;this.startTime=Date.now();e.touchHandlerFn("dragStart",t.pageX-e.offsetLeft,t.pageY-e.offsetTop)};l.prototype._cancelDrag=function(t){this.touchCount=0;this._listen(t,false);if(this.dragging){this.dragging=false;t.touchHandlerFn("dragCancel")}return true};l.prototype._onTouchMove=function(t,e){var n=Date.now();if(n-this.lastMoveTime<o)return true;this.lastMoveTime=n;if(!this.dragging){if(Math.abs(t.clientX-this.startX)+Math.abs(t.clientY-this.startY)<i){return false}if(n-this.startTime<r){this._listen(e,false);return false}return this._startDrag(t,e)}e.touchHandlerFn("drag",t.pageX-e.offsetLeft,t.pageY-e.offsetTop);return true};l.prototype._onTouchEnd=function(t,e){if(this.dragging&&Date.now()-this.startTime<s){return this._cancelDrag(e)}var n=this.dragging?"dragEnd":"tap";e.touchHandlerFn(n,t.pageX-e.offsetLeft,t.pageY-e.offsetTop);this._listen(e,false);this.dragging=false;return true};l.prototype.listenOn=function(t,e){t.touchHandlerFn=e;t.addEventListener("touchstart",h,{passive:true});t.addEventListener("mousedown",f)}},{}],13:[function(t,e,n){"use strict";t("./mainUi.less");var i=t("./ContextMenu");var o=t("./Dome");var r=t("./getText");var s=t("../nwUtil");var a=t("./TaskDlg");var l=t("./TouchManager");var u=t("./util");var h=33;var c=0,p=1;var d=[c,p];function f(t,e){this.app=t;this.eventHandler=e;this.curDisplay=c;this.alertInterval=null;this.alertOn=false;this.flashCount=0;o.init(null,s.getArranger())}e.exports=f;f.prototype.createUi=function(){if(!s.isNw())document.body.style.backgroundColor="#222";o.setPageTitle(this.app.appName);var t=o.newDiv(document.body,"mainDiv");this._createGauge(t);this._createButtons(t)};f.prototype._createGauge=function(t){var e=this.gauge=t.newDiv("gauge");this.green=e.newDiv("colorBand green");this.amber=e.newDiv("colorBand amber");this.red=e.newDiv("colorBand red");this.label=e.newDiv("label");var n=this;l.listenOn(e.elt,function(t){if(t!=="tap")return;n._switchDisplay()})};f.prototype._createButtons=function(t){this.pauseBtn=o.newBtn(t,"pauseBtn",r("pauseBtn"),this.eventHandler.bind(null,"pause"));this.workBtn=o.newBtn(t,"workBtn",r("workBtn"),this.eventHandler.bind(null,"backToWork"));this.workBtn.setVisible(false);this.settingsBtn=o.newGfxBtn(t,"settingsBtn",this._showSettingsMenu.bind(this))};f.prototype._showSettingsMenu=function(){var t=new i;t.addOption(r("gotBreakAction"),this.eventHandler.bind(this,"gotBreak"));t.addOption(r("taskAction"),this._showTaskMenu.bind(this));if(s.isNw())t.addOption(r("exitAction"),this.eventHandler.bind(this,"exit"));t.attachMenu(this.settingsBtn)};function g(){var t=this.ui;t.app.workometer.switchTask(this.taskName);t.refresh()}f.prototype._showTaskMenu=function(){var t=new i;t.addOption(r("newTaskAction"),this._showTaskDlg.bind(this,"new"));t.addOption(r("editTaskAction"),this._showTaskDlg.bind(this,"edit"));var e=this.app.workometer;for(var n in e.tasks){var o=t.addOption(n||r("unnamedTask"),g);o.ui=this;o.taskName=n}t.attachMenu(this.settingsBtn)};f.prototype.setWorking=function(t){var e=t?this.workBtn:this.pauseBtn;var n=t?this.pauseBtn:this.workBtn;e.toggleClass("activated",true);window.setTimeout(function(){e.setVisible(false);e.toggleClass("activated",false);n.setVisible(true)},1e3)};f.prototype.displayGauge=function(t,e){var n=Math.min(t,h);t-=n;var i=Math.min(t,h);t-=i;var o=Math.min(t,h);var r=o===h;this.green.setStyle("width",n+"%");this.amber.setStyle("width",i+"%");this.red.setStyle("width",r?null:o+"%");this.gauge.toggleClass("full",r);this.label.setText(e)};f.prototype.refresh=function(){var t=this.workStatus=this.workStatus||{};this.app.workometer.getStatus(t);var e;if(t.isResting){e=r("resting")+": "+u.ms2str(t.fatigue)}else{switch(this.curDisplay){case c:e=r("todaysWork")+": "+u.ms2str(t.todaysWork);break;case p:var n=t.taskName||r("unnamedTask");e=n+": "+u.ms2str(t.taskWork);break}}this.displayGauge(t.level,e)};f.prototype._switchDisplay=function(){this.curDisplay=(this.curDisplay+1)%d.length;this.refresh()};f.prototype._flashAlert=function(){var t=this.alertOn=!this.alertOn;this.gauge.toggleClass("alert",t);if(t)return;if(!this.flashCount)return;this.flashCount--;if(this.flashCount===0){window.clearInterval(this.alertInterval);this.alertInterval=null}};f.prototype.showAlert=function(t){if(this.alertInterval&&!this.flashCount)return;this.flashCount=t;if(!this.alertInterval){this.alertInterval=window.setInterval(this._flashAlert.bind(this),70)}};f.prototype.stopAlert=function(){this.flashCount=1};f.prototype._showTaskDlg=function(t){new a(t,this,this.refresh.bind(this))}},{"../nwUtil":6,"./ContextMenu":8,"./Dome":9,"./TaskDlg":11,"./TouchManager":12,"./getText":16,"./mainUi.less":17,"./util":20}],14:[function(t,e,n){var i=".contextMenu {\n  position: relative;\n  width: 150px;\n  background-color: rgba(120, 120, 120, 0.2);\n  border-radius: 7px;\n  border: 1px solid #58636d;\n}\n.contextMenu .menuOption {\n  margin: 1px 1px 0 1px;\n  padding: 11px;\n  border-radius: 7px;\n  background-color: rgba(0, 0, 0, 0.7);\n  color: #e4e4e4;\n}\n";t("lessify")(i);e.exports=i},{lessify:22}],15:[function(t,e,n){e.exports={pauseBtn:"Take a break",workBtn:"I am here",hourShort:"h",minuteShort:"min",todaysWork:"today",unnamedTask:"(default task)",resting:"resting",gotBreakAction:"Got a break",taskAction:"Tasks...",exitAction:"Exit",newTaskAction:"New task...",editTaskAction:"Edit task...",cancelAction:"Cancel",confirmTitle:"Confirm",OK:"OK",editTaskTitle:"Edit Task",newTaskTitle:"New Task",newTask:"Create new task",delTask:"Delete task",taskName:"Name",taskTime:"Worked time",invalidValue:"Invalid value",problem:"Problem"}},{}],16:[function(t,e,n){"use strict";var i=t("./en_dict.json");function o(t){return i[t]}e.exports=o},{"./en_dict.json":15}],17:[function(t,e,n){var i='body {\n  -webkit-touch-callout: none;\n  /* iOS Safari */\n  -webkit-user-select: none;\n  /* Chrome/Safari/Opera */\n  -moz-user-select: none;\n  /* Firefox */\n  -ms-user-select: none;\n  /* Internet Explorer/Edge */\n  user-select: none;\n  /* Non-prefixed version, currently not supported by any browser */\n  -webkit-app-region: drag;\n  background: transparent;\n  font-family: "Arial";\n  font-size: 16px;\n  margin: 0px;\n}\n::-webkit-scrollbar {\n  -webkit-appearance: none;\n  width: 7px;\n  height: 7px;\n}\n::-webkit-scrollbar-track {\n  -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.2);\n  -webkit-border-radius: 10px;\n  border-radius: 7px;\n  margin: 1px;\n}\n::-webkit-scrollbar-thumb {\n  border-radius: 7px;\n  background-color: rgba(0, 0, 0, 0.5);\n  -webkit-box-shadow: 0 0 1px rgba(255, 255, 255, 0.5);\n}\n.dialog {\n  padding: 10px;\n  background-color: #ddd;\n  color: #000;\n  border-radius: 7px;\n}\n.dialogTitle {\n  font-size: 30px;\n  background-color: #ccc;\n  color: #000;\n  border: 1px solid #afafaf;\n  border-radius: 7px;\n  margin: -6px -6px 0px -6px;\n  padding: 3px 0px 3px 6px;\n}\n.mainDiv {\n  background: rgba(76, 97, 94, 0.5);\n  border-radius: 7px;\n  border: 1px solid rgba(0, 78, 255, 0.32);\n  padding-left: 12px;\n  width: 392px;\n}\n.mainDiv .gauge {\n  -webkit-app-region: no-drag;\n  display: inline-block;\n  position: relative;\n  margin: 5px;\n  background-color: #000;\n  border-radius: 7px;\n  width: 210px;\n  height: 30px;\n  box-sizing: border-box;\n  padding: 4px 0 0 4px;\n}\n.mainDiv .gauge.alert {\n  background-color: #a06000;\n}\n.mainDiv .gauge .colorBand {\n  display: inline-block;\n  height: calc(100% - 2px);\n}\n.mainDiv .gauge .colorBand.green {\n  border-radius: 5px 0 0 5px;\n  background-color: green;\n}\n.mainDiv .gauge .colorBand.amber {\n  background-color: #A17F13;\n}\n.mainDiv .gauge .colorBand.red {\n  background-color: #A72300;\n}\n.mainDiv .gauge.full .colorBand {\n  background-color: #A72300;\n}\n.mainDiv .gauge.full .colorBand.red {\n  border-radius: 0 5px 5px 0;\n  width: calc(34% - 2px);\n}\n.mainDiv .gauge.alert .colorBand {\n  background-color: red;\n}\n.mainDiv .gauge .label {\n  position: absolute;\n  top: 1px;\n  line-height: 30px;\n  width: 100%;\n  text-align: center;\n  color: #a7a7a7;\n  text-shadow: 1px 1px 1px black;\n}\n.mainDiv .workBtn,\n.mainDiv .pauseBtn {\n  -webkit-app-region: no-drag;\n  display: inline-block;\n  vertical-align: top;\n  box-sizing: border-box;\n  margin: 5px;\n  width: 100px;\n  height: 30px;\n  background-color: #000;\n  border-radius: 7px;\n  border: 1px solid #5a7da2;\n  color: #666;\n  line-height: 30px;\n  text-align: center;\n}\n.mainDiv .workBtn.activated,\n.mainDiv .pauseBtn.activated {\n  border: 1px solid #74b5a6;\n  color: white;\n}\n.mainDiv .settingsBtn {\n  -webkit-app-region: no-drag;\n  display: inline-block;\n  vertical-align: top;\n  box-sizing: border-box;\n  margin: 5px;\n  width: 40px;\n  height: 30px;\n  background-color: #000;\n  border-radius: 7px;\n  border: 1px solid #5a7da2;\n}\n.mainDiv .settingsBtn .settingsBtnIcon {\n  height: 100%;\n  background: url("assets/settings.png") 50% no-repeat;\n  -webkit-filter: sepia(0.9) brightness(2);\n  background-size: auto 95%;\n}\n';t("lessify")(i);e.exports=i},{lessify:22}],18:[function(t,e,n){var i=".popupOverlay {\n  z-index: 2000;\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 100%;\n  height: 100%;\n  border-radius: 7px;\n  background-color: rgba(0, 0, 0, 0.4);\n  transition: opacity 300ms ease-out;\n  opacity: 0;\n}\n.popupDlg {\n  position: relative;\n  margin: 30px auto;\n  width: 305px;\n}\n.popupDlg .content {\n  padding: 20px;\n  white-space: pre-wrap;\n  word-wrap: break-word;\n}\n.popupDlg .btnDiv {\n  width: 100%;\n  display: inline-block;\n  margin: -10px 0 -10px 0;\n}\n.popupDlg .btnDiv .popupDlgButton {\n  float: right;\n}\n";
t("lessify")(i);e.exports=i},{lessify:22}],19:[function(t,e,n){var i=".nameInput {\n  margin-top: 1px;\n}\n.inputLbl {\n  margin-top: 5px;\n}\n.taskDlg {\n  position: relative;\n  margin: 7px auto;\n  width: 350px;\n}\n.taskDlg .content {\n  padding: 20px;\n  white-space: pre-wrap;\n  word-wrap: break-word;\n}\n.taskDlg .btnDiv {\n  width: 100%;\n  margin: -10px 0 -10px 0;\n  display: inline-block;\n}\n.taskDlg button {\n  margin: 5px;\n  min-width: 100px;\n  height: 40px;\n  border-radius: 7px;\n  border-color: #74b5a6;\n  background-color: #aaa;\n}\n.taskDlg .newTaskButton,\n.taskDlg .cancelButton,\n.taskDlg .editButton {\n  float: right;\n}\n";t("lessify")(i);e.exports=i},{lessify:22}],20:[function(t,e,n){"use strict";var i=t("./getText");var o=6e4,r=36e5;n.ms2str=function(t){var e=Math.round(t/o);var n=Math.floor(e/60);if(n){var r=e-n*60;return n+i("hourShort")+("0"+r).slice(-2)}else{return e+i("minuteShort")}};n.str2ms=function(t){var e=t.split(i("hourShort"));if(e.length>1){return parseInt(e[0])*r+(e[1]?parseInt(e[1])*o:0)}else{return parseInt(e[0])*o}}},{"./getText":16}],21:[function(t,e,n){e.exports=function(t,e){var n=e||document;if(n.createStyleSheet){var i=n.createStyleSheet();i.cssText=t;return i.ownerNode}else{var o=n.getElementsByTagName("head")[0],r=n.createElement("style");r.type="text/css";if(r.styleSheet){r.styleSheet.cssText=t}else{r.appendChild(n.createTextNode(t))}o.appendChild(r);return r}};e.exports.byUrl=function(t){if(document.createStyleSheet){return document.createStyleSheet(t).ownerNode}else{var e=document.getElementsByTagName("head")[0],n=document.createElement("link");n.rel="stylesheet";n.href=t;e.appendChild(n);return n}}},{}],22:[function(t,e,n){e.exports=t("cssify")},{cssify:21}],23:[function(t,e,n){e.exports={main:"index.html",name:"screen_break",version:"0.2.0",dependencies:{},devDependencies:{browserify:"~13.0.0",lessify:"^1.0.2",watchify:"^3.2.2","uglify-js":"~2.6.2"},scripts:{build:"browserify js/app.js --no-detect-globals --bare -t lessify | uglifyjs -o build/build.js -m","dev-build":"watchify js/app.js --no-detect-globals --bare -t lessify -o build/build.js -v",test:"watchify js/test/testApp.js -o build/testBuild.js -t lessify -v"},window:{title:"node-webkit app",icon:"appIcon.png",toolbar:false,transparent:true,frame:false,width:408,height:42,position:"center",min_width:233,min_height:42}}},{}]},{},[3]);