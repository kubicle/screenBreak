(function(){function t(e,i,n){function o(s,a){if(!i[s]){if(!e[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(r)return r(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var h=i[s]={exports:{}};e[s][0].call(h.exports,function(t){var i=e[s][1][t];return o(i||t)},h,h.exports,t,e,i,n)}return i[s].exports}for(var r="function"==typeof require&&require,s=0;s<n.length;s++)o(n[s]);return o}return t})()({1:[function(t,e,i){"use strict";function n(t){t=t||{};this.name=t.name||"";this.timeWorked=t.timeWorked||0}e.exports=n;n.prototype.serialize=function(){return{name:this.name,timeWorked:this.timeWorked}};n.prototype.getName=function(){return this.name};n.prototype.getTimeWorked=function(){return this.timeWorked};n.prototype.updateTime=function(t){this.timeWorked=t};n.prototype.rename=function(t){this.name=t}},{}],2:[function(t,e,i){"use strict";var n=t("./constants");var o=t("./Task");function r(t){this.level=0;this.isResting=true;t=t||{};this.lastUserAction=Date.now();this.time0=t.lastWorkTime||Date.now();this.taskWork=t.taskWork||0;this.fatigue=t.fatigue||0;this.tasks=t.tasks||{};this.todaysWork=t.todaysWork||0;this.todaysLongestWork=t.todaysLongestWork||0;this.todaysTooLongCount=t.todaysTooLongCount||0;if(t.curTaskName!==undefined){this._loadCurTask(t.curTaskName)}else{this._createTask()}}e.exports=r;r.prototype.gotBreak=function(t){this._removeFatigue(t);this.taskWork=Math.max(this.taskWork-t,0);this.todaysWork=Math.max(this.todaysWork-t,0)};r.prototype.serialize=function(){this._saveCurTask();return{lastWorkTime:this.time0,taskWork:this.taskWork,todaysWork:this.todaysWork,fatigue:this.fatigue,tasks:this.tasks,curTaskName:this.curTask.name}};r.prototype.start=function(){if(!this.isResting)return;this._startTimePeriod();this.isResting=false};r.prototype.stop=function(){if(this.isResting)return;this._startTimePeriod();this.isResting=true};r.prototype.backFromSleep=function(t){if(this.isResting){this._countTime()}else{this.time0+=t;this._startTimePeriod();this._removeFatigue(t)}};r.prototype._startTimePeriod=function(){this._countTime();this.lastUserAction=Date.now()};r.prototype._countTime=function(){var t=Date.now();var e=t-this.time0;this.time0=t;if(t-this.lastUserAction>=n.NEW_DAY_BREAK&&this.todaysWork>0){this.startNewDay();e=0}if(this.isResting){this._removeFatigue(e)}else{this._addFatigue(e);this.taskWork+=e;this.todaysWork+=e;if(e>this.todaysLongestWork)this.todaysLongestWork=e;if(e>n.NONSTOP_PERIOD)this.todaysTooLongCount++}this.level=this.fatigue/n.REST_FOR_NONSTOP_PERIOD*100};r.prototype.startNewDay=function(){this.todaysWork=0;this.todaysLongestWork=0;this.todaysTooLongCount=0;this.fatigue=0;this.lastUserAction=Date.now()};r.prototype._removeFatigue=function(t){this.fatigue=Math.max(this.fatigue-t,0)};r.prototype._addFatigue=function(t){this.fatigue+=t/n.NONSTOP_PERIOD*n.REST_FOR_NONSTOP_PERIOD};r.prototype._loadCurTask=function(t){this.curTask=new o(this.tasks[t]);this.taskWork=this.curTask.timeWorked};r.prototype._saveCurTask=function(){this.curTask.updateTime(this.taskWork);this.tasks[this.curTask.name]=this.curTask.serialize()};r.prototype._createTask=function(){this.curTask=new o;this.taskWork=0};r.prototype.newTask=function(t){this._saveCurTask();this._createTask();if(t)this.curTask.rename(t);this._saveCurTask()};r.prototype.deleteTask=function(){delete this.tasks[this.curTask.name];for(var t in this.tasks){return this._loadCurTask(t)}this._createTask()};r.prototype.switchTask=function(t){this._saveCurTask();this._loadCurTask(t)};r.prototype.renameTask=function(t){delete this.tasks[this.curTask.name];this.curTask.rename(t)};r.prototype.editTaskTime=function(t){this.curTask.updateTime(t);this.taskWork=t};r.prototype.getTask=function(){return this.curTask};r.prototype.getStatus=function(t){this._countTime();t.isResting=this.isResting;t.taskName=this.curTask.name;t.taskWork=this.taskWork;t.todaysWork=this.todaysWork;t.fatigue=this.fatigue;t.level=this.level};r.prototype.getLevel=function(){return this.level}},{"./Task":1,"./constants":4}],3:[function(t,e,i){"use strict";var n=t("./constants");var o=t("../package.json");var r=t("./ui/Ui");var s=t("./Workometer");var a=t("./nwUtil");var l=t("./localPref");function u(){a.initialize();this.appName=o.name;this.appVersion=o.version;this.ui=this.workometer=null;this.isWorking=false;this.lastRefresh=Date.now();this.currentFreq=0}u.prototype.initialize=function(){this.workometer=new s(l.getValue("workometerState"));this.ui=new r(this,this.userEventHandler.bind(this));this.ui.createUi();this.refreshMethod=this.refresh.bind(this);this.refreshInterval=null;a.listenBeforeunload(this.terminate.bind(this));this._noteUserIsHere();this.toggle()};u.prototype.terminate=function(){this.workometer.stop();this._save();l.terminate();a.terminate()};u.prototype._save=function(){l.setValue("workometerState",this.workometer.serialize())};u.prototype.refresh=function(){var t=Date.now();var e=t-this.lastRefresh;this.lastRefresh=t;var i=e-this.currentFreq;if(i>n.SAVE_FREQ){this.workometer.backFromSleep(i);if(this.isWorking)this.toggle()}this.ui.refresh();this._checkAlert()};u.prototype._checkAlert=function(){var t=Date.now();var e=t-this.lastAlertTime;if(this.isWorking){if(e>n.SAVE_FREQ){this._save()}if(e>=n.WORKING_ALERT_FREQ){this.lastAlertTime=t;this.ui.showAlert(5)}var i=t-this.lastUserActionTime;if(this.workometer.getLevel()>=n.ANNOYING_ALERT_LEVEL&&i>n.ANNOYING_ALERT_REPEAT_DELAY){this.ui.showAlert()}if(i>n.AUTOPAUSE_AFTER_INACTION){this.toggle()}}else{if(e>=n.RESTING_ALERT_FREQ){this.lastAlertTime=t;this.ui.showAlert(20)}}};u.prototype.toggle=function(){if(this.isWorking){this.workometer.stop()}else{this.workometer.start()}this.isWorking=!this.isWorking;this.ui.setWorking(this.isWorking);this.refresh();window.clearInterval(this.refreshInterval);this.currentFreq=this.isWorking?n.WORKING_REFRESH_FREQ:n.RESTING_REFRESH_FREQ;this.refreshInterval=window.setInterval(this.refreshMethod,this.currentFreq)};u.prototype._noteUserIsHere=function(){this.ui.stopAlert();this.lastUserActionTime=this.lastAlertTime=Date.now()};u.prototype.gotBreak=function(){this.workometer.gotBreak(n.GOT_BREAK_MS);this.refresh()};u.prototype.backToWork=function(){if(!this.isWorking)this.toggle()};u.prototype.goOnPause=function(){if(this.isWorking)this.toggle()};u.prototype.userEventHandler=function(t){this._noteUserIsHere();switch(t){case"pause":return this.goOnPause();case"backToWork":return this.backToWork();case"gotBreak":return this.gotBreak();case"exit":return this.terminate()}};var h=new u;h.initialize()},{"../package.json":22,"./Workometer":2,"./constants":4,"./localPref":5,"./nwUtil":7,"./ui/Ui":14}],4:[function(t,e,i){"use strict";var n=1e3,o=6e4,r=36e5;i.WORKING_REFRESH_FREQ=10*n;i.RESTING_REFRESH_FREQ=1*n;i.SAVE_FREQ=3*o;i.AUTOPAUSE_AFTER_INACTION=75*o;i.NONSTOP_PERIOD=60*o;i.REST_FOR_NONSTOP_PERIOD=5*o;i.NEW_DAY_BREAK=6*r;i.GOT_BREAK_MS=5*o;i.WORKING_ALERT_FREQ=15*o;i.RESTING_ALERT_FREQ=1*o;i.ANNOYING_ALERT_LEVEL=100;i.ANNOYING_ALERT_REPEAT_DELAY=10*o},{}],5:[function(t,e,i){"use strict";var n=t("./log");var o="screenBreak.1";function r(){this.saveTimeout=null;this.map={};this._saveHandler=this._saveNow.bind(this);try{var t=window.localStorage.getItem(o);if(t)this.map=JSON.parse(t)}catch(e){n.logError("Cannot load local preferences: "+e)}}r.prototype.terminate=function(){if(this.saveTimeout)this._saveNow()};r.prototype._saveLater=function(){if(this.saveTimeout)return;this.saveTimeout=window.setTimeout(this._saveHandler,6e4)};r.prototype._saveNow=function(){window.clearTimeout(this.saveTimeout);this.saveTimeout=null;try{window.localStorage.setItem(o,JSON.stringify(this.map))}catch(t){n.logError("Cannot save local preferences: "+t)}};r.prototype.getValue=function(t,e){var i=this.map[t];return i!==undefined?i:e};r.prototype.setValue=function(t,e){this.map[t]=e;this._saveLater()};e.exports=new r},{"./log":6}],6:[function(t,e,i){"use strict";var n=console;var o=0,r=1,s=2,a=3,l=4;function u(){this.level=NaN;this.logfunc=null;this.DEBUG=0;this.INFO=1;this.WARN=2;this.ERROR=3;this.FATAL=4;this.debugBreed=false;this.debugGroup=false}u.prototype.setLevel=function(t){if(t===this.level)return;this.level=t;this.debug=t<=o?this.logDebug:null;this.info=t<=r?this.logInfo:null;this.warn=t<=s?this.logWarn:null;this.error=t<=a?this.logError:null;this.fatal=t<=l?this.logFatal:null};u.prototype.setLogFunc=function(t){this.logfunc=t};u.prototype._newLogFn=function(t,e){var i=this;return function(o){if(i.level>t)return;if(i.logfunc&&!i.logfunc(t,o))return;e.call(n,o)}};var h=e.exports=new u;u.prototype.logDebug=h._newLogFn(o,n.debug);u.prototype.logInfo=h._newLogFn(r,n.info);u.prototype.logWarn=h._newLogFn(s,n.warn);u.prototype.logError=h._newLogFn(a,n.error);u.prototype.logFatal=h._newLogFn(l,n.error);h.setLevel(r)},{}],7:[function(t,e,i){"use strict";var n=t("./ui/Arranger");var o=false;var r=[];var s=null;var a,l,u,h;var c,p,d,f,g;var v,m,k,w;var y=0;function T(){}T.prototype.getWidth=function(){return k};T.prototype.getHeight=function(){return w};T.prototype.addElement=function(t){if(o){var e=2*s.MARGIN;if(t.width+e>k||t.height+e>w){var i=Math.max(k,t.width+e);var n=Math.max(w,t.height+e);x(i,n);var r=Math.min(v,u+a-i);var c=Math.min(m,h+l-n);if(r!==v||c!==m)b(r,c)}}};T.prototype.reduce=function(t,e){if(o){var i=s.MARGIN;t+=i;e+=i;var n=v,r=m;var c=k,y=w;if(t<k){if(v<p)n=Math.min(p,u+a-t);c=Math.max(f,t)}if(e<w){if(m<d)r=Math.min(d,h+l-e);y=Math.max(g,e)}if(n!==v||r!==m)b(n,r);if(c!==k||y!==w)x(c,y)}};function b(t,e){y=Date.now();c.x=t;c.y=e;v=t;m=e}function x(t,e){c.width=t;c.height=e;k=t;w=e}i.getArranger=function(){if(s)return s;s=new n(new T);return s};function _(){var t=nw.Screen.screens,e;if(!t)return console.warn("nw.Screen.screens is undefined");for(var i=0;i<t.length;i++){e=t[i].work_area;if(v>=e.x&&v<e.x+e.width&&m>=e.y&&m<e.y+e.height){break}}u=e.x;h=e.y;a=e.width;l=e.height}function D(){v=p=c.x;m=d=c.y;k=f=c.width;w=g=c.height}function E(){u=h=0;a=k=document.documentElement.clientWidth;l=w=document.documentElement.clientHeight}function A(){a=k=document.documentElement.clientWidth;l=w=document.documentElement.clientHeight}i.listenBeforeunload=function(t){r.push(t)};function N(){for(var t=0;t<r.length;t++){r[t]()}return true}function B(){nw.Screen.Init();c=nw.Window.get();D();c.on("close",function(){N()});c.on("move",function(t,e){v=t;m=e;if(Date.now()-y>200){p=t;d=e;_()}});_()}function R(){nw.Window.get().close(true)}function W(){window.addEventListener("beforeunload",N);window.addEventListener("resize",A);E()}i.initialize=function(){o=typeof process!=="undefined"&&!!process.versions["node-webkit"];if(o){B()}else{W()}};i.terminate=function(){if(o){R()}};i.isNw=function(){return o};i.envInfo=function(){if(o){return"NW.js: "+process.versions["node-webkit"]}else{return"Browser: "+navigator.userAgent}}},{"./ui/Arranger":8}],8:[function(t,e,i){"use strict";var n=t("./Dome");var o=10;function r(t){this.viewportHandler=t;this.MARGIN=o;this.xMin=[];this.yMin=[];this.xMax=[];this.yMax=[]}e.exports=r;r.prototype._tryToFit=function(t,e){var i=this.viewportHandler.getWidth();var n=this.viewportHandler.getHeight();var r=Math.max(Math.min(t.left,i-t.width-o),o);var s=Math.max(Math.min(t.top,n-t.height-o),o);e[0]+=r-t.left;e[1]+=s-t.top;t.left=r;t.top=s};r.prototype.addElement=function(t){t.style.transform=null;var e=[0,0];var i=n.getRect(t);this._tryToFit(i,e);this.viewportHandler.addElement(i);this._tryToFit(i,e);t.style.transform="translate("+e[0]+"px, "+e[1]+"px)";this.xMin.push(i.left);this.yMin.push(i.top);this.xMax.push(i.left+i.width);this.yMax.push(i.top+i.height);t._rect=i};function s(t,e){var i=t.indexOf(e);if(i!==-1)t.splice(i,1)}r.prototype.removeElement=function(t){var e=t._rect;s(this.xMin,e.left);s(this.yMin,e.top);s(this.xMax,e.left+e.width);s(this.yMax,e.top+e.height);var i=Math.max.apply(null,this.xMax);var n=Math.max.apply(null,this.yMax);this.viewportHandler.reduce(i,n)}},{"./Dome":10}],9:[function(t,e,i){"use strict";t("./contextMenu.less");var n=t("./Dome");var o=t("./getText");var r=t("./PopupDlg");function s(){this.options=[];this.parent=document.body;this.menu=n.newDiv(null,"contextMenu")}e.exports=s;function a(){this.contextMenu._close();if(this.action)this.action.call(this)}s.prototype.addOption=function(t,e){var i=n.newDiv(this.menu,"menuOption").setText(t);i.action=e;i.contextMenu=this;n.tapBehavior(i,a);this.options.push(i);return i};s.prototype.attachMenu=function(t){this.addOption(o("cancelAction"),null);var e=n.getRect(t);this.menu.setStyle("left",e.left+e.width/2+"px");this.menu.setStyle("top",e.top+e.height/2+"px");r.attachWithOverlay(this.menu,this.parent)};s.prototype.detachMenu=function(){r.detachWithOverlay(this.menu)};s.prototype._close=function(){this.detachMenu()}},{"./Dome":10,"./PopupDlg":11,"./contextMenu.less":15,"./getText":17}],10:[function(t,e,i){"use strict";var n=null;var o=null;var r=null;var s=1;a.init=function(t,e){o=t;n=e};function a(t,e,i,n){this.type=e;var s=this.elt=document.createElement(e);this.isFloating=false;if(n&&n[0]==="#"){r.add(n.substr(1),this);if(i[0]==="#")i=i.substr(1)}if(i)s.className=i;if(o)o.paint(s,i);if(t){(t instanceof a?t.elt:t).appendChild(s)}}e.exports=a;a.prototype.appendTo=function(t,e){(t instanceof a?t.elt:t).appendChild(this.elt);this.isFloating=e;if(n&&e)n.addElement(this.elt)};a.removeChild=function(t,e){if(n&&e.isFloating)n.removeElement(e.elt);if(t instanceof a)t=t.elt;t.removeChild(e.elt)};a.prototype.removeChild=function(t){a.removeChild(this,t)};a.prototype.setText=function(t){this.elt.textContent=t;return this};a.prototype.setHtml=function(t){this.elt.innerHTML=t;return this};a.prototype.setAttribute=function(t,e){this.elt.setAttribute(t,e);return this};a.prototype.setStyle=function(t,e){this.elt.style[t]=e;return this};a.prototype.setVisible=function(t){if(t===this.isVisible())return this;this.elt.style.display=t?"":"none";this._isVisible=!!t;if(n&&this.isFloating){if(t)n.addElement(this.elt);else n.removeElement(this.elt)}return this};a.prototype.isVisible=function(){return this._isVisible||this._isVisible===undefined};a.prototype.setEnabled=function(t){this.elt.disabled=!t;this.toggleClass("disabled",!t);return this};a.prototype.text=function(){return this.elt.textContent};a.prototype.html=function(){return this.elt.innerHTML};a.prototype.value=function(){return this.elt.value};a.prototype.isChecked=function(){return this.elt.checked};a.prototype.getDomElt=function(){return this.elt};a.prototype.clear=function(){this.elt.innerHTML=""};a.prototype.on=function(t,e){var i=this;this.elt.addEventListener(t,function(t){e.call(i,t)})};a.prototype.toggleClass=function(t,e){var i=this.elt;var n=i.className,r=" "+n+" ";var s=" "+t+" ";var a=r.indexOf(s);if(e){if(a>=0)return;if(o)o.toggle(i,t,e);i.className=n+" "+t}else{if(a<0)return;i.className=r.replace(s," ").trim();if(o)o.toggle(i,t,e)}};a.prototype.scrollToBottom=function(){this.elt.scrollTop=this.elt.scrollHeight};a.newDiv=function(t,e,i){return new a(t,"div",e,i||e)};a.prototype.newDiv=function(t,e){return new a(this,"div",t,e||t)};a.newButton=function(t,e,i,n){var o=new a(t,"button",e+"Button",e);if(i)o.elt.innerText=i;o.on("click",n);return o};a.newBtn=function(t,e,i,n){var o=a.newDiv(t,e).setText(i);o.on("click",n);return o};a.newGfxBtn=function(t,e,i){var n=a.newBtn(t,e,null,i);n.newDiv(e+"Icon btnIcon");return n};a.tapBehavior=function(t,e){t.on("click",function(t){t.stopPropagation();e.call(this)})};a.newLink=function(t,e,i,n){var o=new a(t,"a",e+"Link",e);o.setAttribute("href",n);o.setText(i);return o};a.newLabel=function(t,e,i){return new a(t,"div",e,e).setText(i)};a.newBreak=function(t){return new a(t,"br")};a.newInput=function(t,e,i,n){var o=e+"Label";a.newLabel(t,o+" inputLbl",i,o);var r=new a(t,"input",e+"Input inputBox",e);if(n!==undefined)r.elt.value=n;return r};a.newCheckbox=function(t,e,i,n,o){var r=new a(t,"div",e+"Div chkBoxDiv");var l=new a(r,"input",e+"ChkBox chkBox",e);var u=l.elt;u.type="checkbox";u.name=e;if(n!==undefined)u.value=n;u.id=e+"ChkBox"+(n!==undefined?n:s++);if(o)u.checked=true;new a(r,"label",e+"ChkLabel chkLbl",e).setText(i).setAttribute("for",u.id);return l};a.newRadio=function(t,e,i,n,o){if(!n)n=i;var r=[];for(var s=0;s<i.length;s++){var l=r[s]=new a(t,"input",e+"RadioBtn radioBtn",e);var u=l.elt;u.type="radio";u.name=e;u.value=n[s];u.id=e+"Radio"+n[s];if(n[s]===o)u.checked=true;new a(t,"label",e+"RadioLabel radioLbl",e).setText(i[s]).setAttribute("for",u.id)}return r};a.getRadioValue=function(t){for(var e=0;e<t.length;e++){if(t[e].elt.checked)return t[e].elt.value}};a.newDropdown=function(t,e,i,n,o){if(!n)n=i;var r=new a(t,"select",e+"DropDwn dropDwn",e);r.values=n;var s=0;for(var l=0;l<i.length;l++){var u=new a(r,"option").elt;u.value=n[l];u.textContent=i[l];if(n[l]===o)s=l}r.elt.selectedIndex=s;return r};a.prototype.select=function(t){var e=this.values.indexOf(t);if(e!==-1)this.elt.selectedIndex=e};function l(t,e,i,n){this.left=t;this.top=e;this.width=i;this.height=n}a.getRect=function(t){var e=(t.elt||t).getBoundingClientRect();return new l(e.left,e.top,e.width,e.height)};function u(){this.ctrl={}}a.newGroup=function(){r=new u;return r};u.prototype.add=function(t,e){this.ctrl[t]=e};u.prototype.get=function(t){return this.ctrl[t]};u.prototype.setEnabled=function(t,e,i){if(t==="ALL")t=Object.keys(this.ctrl);for(var n=0;n<t.length;n++){if(i&&i.indexOf(t[n])!==-1)continue;var o=this.ctrl[t[n]];if(!o){console.error("Invalid control name:",t[n]);continue}o.setEnabled(e)}};u.prototype.setVisible=function(t,e,i){if(t==="ALL")t=Object.keys(this.ctrl);for(var n=0;n<t.length;n++){if(i&&i.indexOf(t[n])!==-1)continue;var o=this.ctrl[t[n]];if(!o){console.error("Invalid control name:",t[n]);continue}o.setVisible(e)}};a.setPageTitle=function(t){document.head.getElementsByTagName("title")[0].textContent=t};a.getSelectedText=function(){var t=window.getSelection();if(!t.rangeCount)return null;var e=t.getRangeAt(0);var i=e.startContainer.data;if(!i)return null;return i.substring(e.startOffset,e.endOffset)};a.downloadFile=function(t,e){var i=new Blob([t]);var n=document.createElement("a");n.href=URL.createObjectURL(i);n.download=e;n.click()};a.prototype.hasFile=function(){var t=this.elt.files;return t&&t.length>0};a.prototype.uploadFile=function(t){var e=this.elt.files;if(!e)return console.error("Invalid field type for uploadFile: "+this.type);if(!e.length)return false;var i=new FileReader;i.readAsText(e[0]);i.onloadend=function(){return t(i.result)};return true}},{}],11:[function(t,e,i){"use strict";t("./popupDlg.less");var n=t("./Dome");var o=t("./getText");function r(){var t=this.dlg;if(t.options)t.options.choice=this.id;a.detachWithOverlay(t.dialog);if(t.validateFn)t.validateFn(t.options)}function s(t,e,i,o){var s=n.newButton(t,"popupDlg",i,r);s.dlg=e;s.id=o}function a(t,e,i,r,l){this.parent=t||document.body;this.options=r;this.validateFn=l;var u=this.dialog=n.newDiv(null,"popupDlg dialog");u.newDiv("dialogTitle").setText(i||o("problem"));var h=u.newDiv("content");n.newLabel(h,"message",e);var c=r&&r.buttons||[o("OK")];var p=u.newDiv("btnDiv");for(var d=0;d<c.length;d++){s(p,this,c[d],d)}a.attachWithOverlay(this.dialog,this.parent)}e.exports=a;function l(t){var e=n.newDiv(null,"popupOverlay");if(t){t=t.elt||t;e.setStyle("left",t.offsetLeft+"px");e.setStyle("top",t.offsetTop+"px");e.setStyle("height",t.scrollHeight+"px")}return e}a.attachWithOverlay=function(t,e){var i=t.overlay=l();i.parent=e;i.appendTo(e);t.appendTo(i,true);i.setStyle("opacity",1)};a.detachWithOverlay=function(t){t.overlay.setStyle("opacity",0);window.setTimeout(function(){t.setVisible(false);n.removeChild(t.overlay.parent,t.overlay)},300)}},{"./Dome":10,"./getText":17,"./popupDlg.less":19}],12:[function(t,e,i){"use strict";t("./taskDlg.less");var n=t("./Dome");var o=t("./getText");var r=t("./PopupDlg");var s=t("./util");function a(t,e,i){var a=t==="new";this.workometer=e.app.workometer;this.task=this.workometer.getTask();this.cb=i;this.oldName=a?"":this.task.getName();this.oldTime=s.ms2str(this.task.getTimeWorked());var l=this.dialog=n.newDiv(null,"taskDlg dialog");l.newDiv("dialogTitle").setText(a?o("newTaskTitle"):o("editTaskTitle"));var u=l.newDiv("content");this.name=n.newInput(u,"name",o("taskName")+":",this.oldName);if(!a)this.time=n.newInput(u,"time",o("taskTime")+":",this.oldTime);var h=l.newDiv("btnDiv");if(a)this._newButton(h,"newTask",o("newTask"));if(!a&&this.oldName)this._newButton(h,"delTask",o("delTask"));if(!a)this._newButton(h,"edit",o("OK"));this._newButton(h,"cancel",o("cancelAction"));r.attachWithOverlay(this.dialog,document.body);this.name.elt.focus()}e.exports=a;function l(){this.dlg._validate(this.action)}a.prototype._newButton=function(t,e,i){var o=n.newButton(t,e,i,l);o.action=e;o.dlg=this};a.prototype._validate=function(t){var e=this.name.value();switch(t){case"edit":if(e&&e!==this.oldName){this.workometer.renameTask(e)}var i=this.time.value();if(i!==this.oldTime){var n=s.str2ms(i);if(!n&&n!==0){return new r(this.dialog,o("invalidValue")+": "+i)}this.workometer.editTaskTime(n)}break;case"newTask":this.workometer.newTask(e);break;case"delTask":var a=o("delTask")+": "+this.oldName+"?";var l={buttons:[o("cancelAction"),o("OK")]};var u=this;return new r(this.dialog,a,o("confirmTitle"),l,function(t){if(!t.choice)return;u.workometer.deleteTask();u._close()});case"cancel":break}this._close()};a.prototype._close=function(){r.detachWithOverlay(this.dialog);this.cb()}},{"./Dome":10,"./PopupDlg":11,"./getText":17,"./taskDlg.less":20,"./util":21}],13:[function(t,e,i){"use strict";var n=10;var o=50;var r=300;var s=500;var a=0;function l(){this.startX=this.startY=0;this.holding=this.dragging=false;this.target=null;this.touchCount=this.startTime=this.lastMoveTime=0}var u=e.exports=new l;function h(t){var e=t.currentTarget;u.touchCount+=t.changedTouches.length;if(u.touchCount>1){return u._cancelDrag(e)}u._onTouchStart(t.changedTouches[0],e)}function c(t){u.touchCount-=t.changedTouches.length;if(u.touchCount>0)return console.warn("Extra touchend count?",t);if(u._onTouchEnd(t.changedTouches[0],u.target)){t.preventDefault()}}function p(t){if(t.changedTouches.length>1)return u._cancelDrag(u.target);if(u._onTouchMove(t.changedTouches[0],u.target)){t.preventDefault()}}function d(t){u.touchCount-=t.changedTouches.length;u._cancelDrag(u.target)}function f(t){if(t.button!==a)return;u._onTouchStart(t,t.currentTarget)}function g(t){if(t.button!==a)return;if(u._onTouchEnd(t,u.target)){t.preventDefault()}}function v(t){if(u._onTouchMove(t,u.target)){t.preventDefault()}}l.prototype._listen=function(t,e){if(e){if(this.target!==null)console.error("Forgot to stop listening on",this.target);this.holding=true;this.target=t;t.addEventListener("touchmove",p,{passive:true});t.addEventListener("touchend",c);t.addEventListener("touchcancel",d);document.addEventListener("mousemove",v);document.addEventListener("mouseup",g)}else{if(this.target===null)return console.warn("Not listening anyway");this.holding=false;this.target=null;t.removeEventListener("touchmove",p);t.removeEventListener("touchend",c);t.removeEventListener("touchcancel",d);document.removeEventListener("mousemove",v);document.removeEventListener("mouseup",g)}};l.prototype._onTouchStart=function(t,e){this._listen(e,true);this.holding=true;this.startX=t.clientX;this.startY=t.clientY;this.startTime=Date.now();var i=this;if(this.holdTimeout)window.clearTimeout(this.holdTimeout);this.holdTimeout=window.setTimeout(function(){i.holdTimeout=null;if(i.holding&&!i.dragging)i._startDrag(t,e)},r)};l.prototype._startDrag=function(t,e){this.dragging=true;this.startTime=Date.now();e.touchHandlerFn("dragStart",t.pageX-e.offsetLeft,t.pageY-e.offsetTop)};l.prototype._cancelDrag=function(t){this.touchCount=0;this._listen(t,false);if(this.dragging){this.dragging=false;t.touchHandlerFn("dragCancel")}return true};l.prototype._onTouchMove=function(t,e){var i=Date.now();if(i-this.lastMoveTime<o)return true;this.lastMoveTime=i;if(!this.dragging){if(Math.abs(t.clientX-this.startX)+Math.abs(t.clientY-this.startY)<n){return false}if(i-this.startTime<r){this._listen(e,false);return false}return this._startDrag(t,e)}e.touchHandlerFn("drag",t.pageX-e.offsetLeft,t.pageY-e.offsetTop);return true};l.prototype._onTouchEnd=function(t,e){if(this.dragging&&Date.now()-this.startTime<s){return this._cancelDrag(e)}var i=this.dragging?"dragEnd":"tap";e.touchHandlerFn(i,t.pageX-e.offsetLeft,t.pageY-e.offsetTop);this._listen(e,false);this.dragging=false;return true};l.prototype.listenOn=function(t,e){t.touchHandlerFn=e;t.addEventListener("touchstart",h,{passive:true});t.addEventListener("mousedown",f)}},{}],14:[function(t,e,i){"use strict";t("./mainUi.less");var n=t("./ContextMenu");var o=t("./Dome");var r=t("./getText");var s=t("./PopupDlg");var a=t("../nwUtil");var l=t("./TaskDlg");var u=t("./TouchManager");var h=t("./util");var c=33;var p=0,d=1;var f=[p,d];function g(t,e){this.app=t;this.eventHandler=e;this.curDisplay=p;this.alertInterval=null;this.alertOn=false;this.flashCount=0;o.init(null,a.getArranger())}e.exports=g;g.prototype.createUi=function(){if(!a.isNw())document.body.style.backgroundColor="#222";o.setPageTitle(r("appDisplayName"));var t=o.newDiv(document.body,"mainDiv");this._createGauge(t);this._createButtons(t)};g.prototype._createGauge=function(t){var e=this.gauge=t.newDiv("gauge");this.green=e.newDiv("colorBand green");this.amber=e.newDiv("colorBand amber");this.red=e.newDiv("colorBand red");this.label=e.newDiv("label");var i=this;u.listenOn(e.elt,function(t){if(t!=="tap")return;i._switchDisplay()})};g.prototype._createButtons=function(t){this.pauseBtn=o.newBtn(t,"pauseBtn",r("pauseBtn"),this.eventHandler.bind(null,"pause"));this.workBtn=o.newBtn(t,"workBtn",r("workBtn"),this.eventHandler.bind(null,"backToWork"));this.workBtn.setVisible(false);this.settingsBtn=o.newGfxBtn(t,"settingsBtn",this._showSettingsMenu.bind(this))};g.prototype._showSettingsMenu=function(){var t=new n;t.addOption(r("taskAction"),this._showTaskMenu.bind(this));t.addOption(r("gotBreakAction"),this.eventHandler.bind(this,"gotBreak"));t.addOption(r("newDayAction"),this._startNewDay.bind(this));t.addOption(r("aboutAction"),this._showAboutBox.bind(this));if(a.isNw())t.addOption(r("exitAction"),this.eventHandler.bind(this,"exit"));t.attachMenu(this.settingsBtn)};g.prototype._startNewDay=function(){this.app.workometer.startNewDay();this.refresh()};g.prototype._showAboutBox=function(){var t=r("appDisplayName");var e="Package: "+this.app.appName+"\nVersion: "+this.app.appVersion+"\n\n"+a.envInfo();return new s(null,e,t)};function v(){var t=this.ui;t.app.workometer.switchTask(this.taskName);t.refresh()}g.prototype._showTaskMenu=function(){var t=new n;t.addOption(r("newTaskAction"),this._showTaskDlg.bind(this,"new"));t.addOption(r("editTaskAction"),this._showTaskDlg.bind(this,"edit"));var e=this.app.workometer;for(var i in e.tasks){var o=t.addOption(i||r("unnamedTask"),v);o.ui=this;o.taskName=i}t.attachMenu(this.settingsBtn)};g.prototype.setWorking=function(t){var e=t?this.workBtn:this.pauseBtn;var i=t?this.pauseBtn:this.workBtn;e.toggleClass("activated",true);window.setTimeout(function(){e.setVisible(false);e.toggleClass("activated",false);i.setVisible(true)},1e3)};g.prototype.displayGauge=function(t,e){var i=Math.min(t,c);t-=i;var n=Math.min(t,c);t-=n;var o=Math.min(t,c);var r=o===c;this.green.setStyle("width",i+"%");this.amber.setStyle("width",n+"%");this.red.setStyle("width",r?null:o+"%");this.gauge.toggleClass("full",r);this.label.setText(e)};g.prototype.refresh=function(){var t=this.workStatus=this.workStatus||{};this.app.workometer.getStatus(t);var e;if(t.isResting){e=r("resting")+": "+h.ms2str(t.fatigue)}else{switch(this.curDisplay){case p:e=r("todaysWork")+": "+h.ms2str(t.todaysWork);break;case d:var i=t.taskName||r("unnamedTask");e=i+": "+h.ms2str(t.taskWork);break}}this.displayGauge(t.level,e)};g.prototype._switchDisplay=function(){this.curDisplay=(this.curDisplay+1)%f.length;this.refresh()};g.prototype._flashAlert=function(){var t=this.alertOn=!this.alertOn;this.gauge.toggleClass("alert",t);if(t)return;if(!this.flashCount)return;this.flashCount--;if(this.flashCount===0){window.clearInterval(this.alertInterval);this.alertInterval=null}};g.prototype.showAlert=function(t){if(this.alertInterval&&!this.flashCount)return;this.flashCount=t;if(!this.alertInterval){this.alertInterval=window.setInterval(this._flashAlert.bind(this),70)}};g.prototype.stopAlert=function(){this.flashCount=1};g.prototype._showTaskDlg=function(t){new l(t,this,this.refresh.bind(this))}},{"../nwUtil":7,"./ContextMenu":9,"./Dome":10,"./PopupDlg":11,"./TaskDlg":12,"./TouchManager":13,"./getText":17,"./mainUi.less":18,"./util":21}],15:[function(t,e,i){(function(){var t=document.getElementsByTagName("head")[0];var e=document.createElement("style");e.type="text/css";var i=".contextMenu{position:relative;width:150px;background-color:rgba(120,120,120,0.2);border-radius:7px;border:1px solid #58636d}.contextMenu .menuOption{margin:1px 1px 0 1px;padding:11px;border-radius:7px;background-color:rgba(0,0,0,0.7);color:#e4e4e4}";if(e.styleSheet){e.styleSheet.cssText=i}else{e.appendChild(document.createTextNode(i))}t.appendChild(e)})()},{}],16:[function(t,e,i){e.exports={appDisplayName:"ScreenBreak",pauseBtn:"Take a break",workBtn:"I am here",hourShort:"h",minuteShort:"min",todaysWork:"today",unnamedTask:"(default task)",resting:"resting",gotBreakAction:"Got a break",taskAction:"Tasks...",newDayAction:"Start new day",aboutAction:"About...",exitAction:"Exit",newTaskAction:"New task...",editTaskAction:"Edit task...",cancelAction:"Cancel",confirmTitle:"Confirm",OK:"OK",editTaskTitle:"Edit Task",newTaskTitle:"New Task",newTask:"Create new task",delTask:"Delete task",taskName:"Name",taskTime:"Worked time",invalidValue:"Invalid value",problem:"Problem"}},{}],17:[function(t,e,i){"use strict";var n=t("./en_dict.json");function o(t){return n[t]}e.exports=o},{"./en_dict.json":16}],18:[function(t,e,i){(function(){var t=document.getElementsByTagName("head")[0];var e=document.createElement("style");e.type="text/css";var i='body{-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-app-region:drag;background:transparent;font-family:"Arial";font-size:16px;margin:0px}::-webkit-scrollbar{-webkit-appearance:none;width:7px;height:7px}::-webkit-scrollbar-track{-webkit-box-shadow:inset 0 0 6px rgba(0,0,0,0.2);-webkit-border-radius:10px;border-radius:7px;margin:1px}::-webkit-scrollbar-thumb{border-radius:7px;background-color:rgba(0,0,0,0.5);-webkit-box-shadow:0 0 1px rgba(255,255,255,0.5)}.dialog{padding:10px;background-color:#ddd;color:#000;border-radius:7px}.dialogTitle{font-size:30px;background-color:#ccc;color:#000;border:1px solid #afafaf;border-radius:7px;margin:-6px -6px 0 -6px;padding:3px 0px 3px 6px}.mainDiv{background:rgba(76,97,94,0.5);border-radius:7px;border:1px solid rgba(0,78,255,0.32);padding-left:12px;width:392px}.mainDiv .gauge{-webkit-app-region:no-drag;display:inline-block;position:relative;margin:5px;background-color:#000;border-radius:7px;width:210px;height:30px;box-sizing:border-box;padding:4px 0 0 4px}.mainDiv .gauge.alert{background-color:#a06000}.mainDiv .gauge .colorBand{display:inline-block;height:calc(100% - 2px)}.mainDiv .gauge .colorBand.green{border-radius:5px 0 0 5px;background-color:green}.mainDiv .gauge .colorBand.amber{background-color:#A17F13}.mainDiv .gauge .colorBand.red{background-color:#A72300}.mainDiv .gauge.full .colorBand{background-color:#A72300}.mainDiv .gauge.full .colorBand.red{border-radius:0 5px 5px 0;width:calc(34% - 2px)}.mainDiv .gauge.alert .colorBand{background-color:red}.mainDiv .gauge .label{position:absolute;top:1px;line-height:30px;width:100%;text-align:center;color:#a7a7a7;text-shadow:1px 1px 1px black}.mainDiv .workBtn,.mainDiv .pauseBtn{-webkit-app-region:no-drag;display:inline-block;vertical-align:top;box-sizing:border-box;margin:5px;width:100px;height:30px;background-color:#000;border-radius:7px;border:1px solid #5a7da2;color:#666;line-height:30px;text-align:center}.mainDiv .workBtn.activated,.mainDiv .pauseBtn.activated{border:1px solid #74b5a6;color:white}.mainDiv .settingsBtn{-webkit-app-region:no-drag;display:inline-block;vertical-align:top;box-sizing:border-box;margin:5px;width:40px;height:30px;background-color:#000;border-radius:7px;border:1px solid #5a7da2}.mainDiv .settingsBtn .settingsBtnIcon{height:100%;background:url("assets/settings.png") 50% no-repeat;-webkit-filter:sepia(.9) brightness(2);background-size:auto 95%}';
if(e.styleSheet){e.styleSheet.cssText=i}else{e.appendChild(document.createTextNode(i))}t.appendChild(e)})()},{}],19:[function(t,e,i){(function(){var t=document.getElementsByTagName("head")[0];var e=document.createElement("style");e.type="text/css";var i=".popupOverlay{z-index:2000;position:absolute;left:0;top:0;width:100%;height:100%;border-radius:7px;background-color:rgba(0,0,0,0.4);transition:opacity 300ms ease-out;opacity:0}.popupDlg{position:relative;margin:30px auto;width:305px}.popupDlg .content{padding:20px;white-space:pre-wrap;word-wrap:break-word}.popupDlg .btnDiv{width:100%;display:inline-block;margin:-10px 0 -10px 0}.popupDlg .btnDiv .popupDlgButton{float:right}";if(e.styleSheet){e.styleSheet.cssText=i}else{e.appendChild(document.createTextNode(i))}t.appendChild(e)})()},{}],20:[function(t,e,i){(function(){var t=document.getElementsByTagName("head")[0];var e=document.createElement("style");e.type="text/css";var i=".nameInput{margin-top:1px}.inputLbl{margin-top:5px}.taskDlg{position:relative;margin:7px auto;width:350px}.taskDlg .content{padding:20px;white-space:pre-wrap;word-wrap:break-word}.taskDlg .btnDiv{width:100%;margin:-10px 0 -10px 0;display:inline-block}.taskDlg button{margin:5px;min-width:100px;height:40px;border-radius:7px;border-color:#74b5a6;background-color:#aaa}.taskDlg .newTaskButton,.taskDlg .cancelButton,.taskDlg .editButton{float:right}";if(e.styleSheet){e.styleSheet.cssText=i}else{e.appendChild(document.createTextNode(i))}t.appendChild(e)})()},{}],21:[function(t,e,i){"use strict";var n=t("./getText");var o=6e4,r=36e5;i.ms2str=function(t){var e=Math.round(t/o);var i=Math.floor(e/60);if(i){var r=e-i*60;return i+n("hourShort")+("0"+r).slice(-2)}else{return e+n("minuteShort")}};i.str2ms=function(t){var e=t.split(n("hourShort"));if(e.length>1){return parseInt(e[0])*r+(e[1]?parseInt(e[1])*o:0)}else{return parseInt(e[0])*o}}},{"./getText":17}],22:[function(t,e,i){e.exports={main:"index.html",name:"screen_break",version:"0.3.3",devDependencies:{browserify:"~13.0.0",eslint:"^7.22.0","node-lessify":"^0.2.0","uglify-js":"~2.6.2",watchify:"^3.2.2"},scripts:{build:"browserify js/app.js --no-detect-globals --bare -t node-lessify | uglifyjs -o build/build.js -m","dev-build":"watchify js/app.js --no-detect-globals --bare -t node-lessify -o build/build.js -v",test:"watchify js/test/testApp.js -o build/testBuild.js -t node-lessify -v"},window:{title:"node-webkit app",icon:"appIcon.png",show_in_taskbar:false,toolbar:false,transparent:true,frame:false,width:408,height:42,position:"center",min_width:233,min_height:42}}},{}]},{},[3]);